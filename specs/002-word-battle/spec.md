# Feature Specification: 英単語ローグライクバトル

**Feature Branch**: `002-word-battle`  
**Created**: 2025-11-12  
**Status**: Draft  
**Input**: User description: "aを武器にしたりTを盾にしたりroguelikeのrogue的なイメージ。短い間英単語が、てきになる。倒したらその中から一文字ゲット。だんだん文字数が長くなって強くなる。ターン制で攻撃し合う。文字は、武器と盾にできる。パラメータはaiに考えてもらう。hpがなくなったら終了。難しめのボスを用意して、倒したらクリアとする。プレイヤー名を英語で入力してもらい、頭を武器と、最後を盾にする。真ん中を回復ポーションにする。敵の次の攻撃が表示されている。プレイヤーは攻撃か防御を選ぶ"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - プレイヤー名入力と初期装備システム (Priority: P1)

ゲーム開始時にプレイヤーが英単語（自分の名前）を入力し、その文字を武器・盾・回復ポーションに自動変換する。最初の文字が武器、最後の文字が盾、中間の文字が回復ポーションとなる。各文字には戦闘パラメータ（攻撃力、防御力、回復量）が割り当てられる。

**Why this priority**: ゲームの独自性を表現する最も重要な要素。プレイヤーの名前がゲームプレイに直接影響するユニークなメカニクス。これがないとゲームの核心的な体験が提供できない。

**Independent Test**: プレイヤーが名前を入力→最初の文字が武器ステータスとして表示→最後の文字が盾ステータスとして表示→中間文字が回復ポーション数として表示、という流れを確認できる。

**Acceptance Scenarios**:

1. **Given** ゲーム開始画面、**When** プレイヤーが3文字以上の英単語（例："CAT"）を入力する、**Then** 最初の文字"C"が武器として、最後の文字"T"が盾として、中間"A"が回復ポーションとして装備される
2. **Given** 名前入力完了後、**When** 戦闘開始前画面が表示される、**Then** 武器の攻撃力、盾の防御力、回復ポーション数が数値で表示される
3. **Given** 2文字の名前（例："AT"）を入力、**When** 装備変換される、**Then** "A"が武器、"T"が盾、回復ポーションは0個となる

---

### User Story 2 - ターン制バトルと敵の次の行動予告 (Priority: P2)

プレイヤーと敵が交互に行動するターン制バトル。敵の次の行動（攻撃または特殊行動）が予告表示され、プレイヤーは「攻撃」または「防御」を選択する。攻撃時は武器の攻撃力で敵にダメージ、防御時は盾の防御力で敵の攻撃を軽減する。

**Why this priority**: ゲームの戦略性を生み出すコア戦闘システム。P1の装備システムが完成した後に、その装備を使った戦闘を実装する。独立してテスト可能。

**Independent Test**: 敵の次の行動予告が表示→プレイヤーが攻撃を選択→敵にダメージ→敵がターン実行→プレイヤーのHPが減少、という戦闘ループを確認できる。

**Acceptance Scenarios**:

1. **Given** 戦闘中、**When** プレイヤーのターン開始時、**Then** 敵の次の行動（「攻撃: 5ダメージ」など）が画面に表示される
2. **Given** 敵の次の行動が「攻撃: 5ダメージ」と予告されている、**When** プレイヤーが「防御」を選択、**Then** 盾の防御力分だけダメージが軽減される（例：防御力3なら2ダメージのみ受ける）
3. **Given** プレイヤーが「攻撃」を選択、**When** 攻撃実行、**Then** 武器の攻撃力分のダメージが敵に与えられ、敵のHPが減少する
4. **Given** プレイヤーのHP≤0、**When** ターン終了判定、**Then** ゲームオーバー画面が表示される

---

### User Story 3 - 敵を倒して文字獲得と成長システム (Priority: P3)

敵を倒すと、その敵の英単語から1文字を獲得できる。獲得した文字は武器または盾に追加でき、文字数が増えるほど攻撃力・防御力が上昇する。短い単語の敵から始まり、徐々に長い単語の敵が出現し、難易度が上がる。

**Why this priority**: ゲームの成長要素とローグライク的な進行感を提供。P2の基本戦闘が完成した後に追加できる。プレイヤーの戦略的な選択と成長体験を強化する。

**Independent Test**: 敵を倒す→文字選択画面が表示→文字を武器に追加→武器の攻撃力が上昇、という成長ループを確認できる。

**Acceptance Scenarios**:

1. **Given** 敵（英単語"CAT"）を倒した、**When** 戦闘終了、**Then** "C", "A", "T"のいずれか1文字を選択する画面が表示される
2. **Given** 文字"A"を選択、**When** 武器または盾のどちらに追加するか選択、**Then** 選択した装備に文字が追加され、パラメータが上昇する
3. **Given** 武器が"C"のみ（攻撃力3）、**When** "A"を武器に追加して"CA"になる、**Then** 攻撃力が上昇する（例：攻撃力6）
4. **Given** 複数の敵を倒し進行、**When** 次の敵が出現、**Then** より長い英単語（"BIRD", "TIGER"など）の敵が出現し、HPと攻撃力が高い

---

### User Story 4 - 回復ポーション使用システム (Priority: P4)

戦闘中、プレイヤーは「攻撃」「防御」に加えて「回復ポーション使用」を選択できる。回復ポーションは初期名前の中間文字数分だけ所持しており、使用すると一定量HPを回復する。使用後は消費され、再使用不可。

**Why this priority**: 戦闘の戦略性をさらに深める要素。P2の基本戦闘システムに追加する形で実装できる。

**Independent Test**: 回復ポーション所持中→使用選択→HP回復→回復ポーション数減少、という流れを確認できる。

**Acceptance Scenarios**:

1. **Given** 回復ポーションを1個以上所持、**When** プレイヤーのターンで「回復ポーション使用」を選択、**Then** HPが回復し、回復ポーション数が1減少する
2. **Given** 回復ポーション0個、**When** プレイヤーのターン、**Then** 「回復ポーション使用」は選択不可（グレーアウト）
3. **Given** HP満タン、**When** 回復ポーション使用、**Then** HPは最大値を超えない

---

### User Story 5 - ボス戦とゲームクリア (Priority: P5)

一定数の敵を倒すと、難易度の高いボス敵が出現する。ボスは長い英単語（6文字以上）で、高いHP・攻撃力・特殊攻撃パターンを持つ。ボスを倒すとゲームクリア画面が表示され、プレイヤーの戦闘統計（倒した敵の数、最終装備など）が表示される。

**Why this priority**: ゲームに明確なゴールと達成感を提供。P1～P4の全システムが完成した後に実装する最終要素。

**Independent Test**: 通常敵を複数倒す→ボス出現→ボスを倒す→クリア画面表示、という流れを確認できる。

**Acceptance Scenarios**:

1. **Given** 5体の通常敵を倒した、**When** 次の敵出現判定、**Then** ボス敵が出現し、特別な演出（BGM変化など）がある
2. **Given** ボス戦闘中、**When** ボスのターン、**Then** 通常攻撃以外に特殊攻撃（2倍ダメージ、防御無視など）を使用する可能性がある
3. **Given** ボスを倒した、**When** 戦闘終了、**Then** ゲームクリア画面が表示され、プレイヤーの統計（倒した敵の数、最終装備の文字列、ターン数など）が表示される
4. **Given** クリア画面表示中、**When** リスタートボタンを押す、**Then** ゲームが初期状態に戻り、名前入力画面から再開できる

---

### Edge Cases

- プレイヤー名に1文字しか入力されなかった場合の処理（武器のみ、盾と回復ポーションなし）
- プレイヤー名に非英字（数字、記号、日本語など）が含まれる場合の入力制限または除外
- 敵を倒した際に獲得文字が既に装備に含まれている場合の重複処理
- 回復ポーションを使用せずにクリアした場合のボーナスまたは統計表示
- ボス戦闘中にプレイヤーのHPが0になった場合の特別なゲームオーバー演出
- 武器または盾の文字数が極端に長くなった場合（10文字以上）のUI表示とパラメータバランス
- プレイヤーが攻撃も防御もせず、毎ターン回復ポーションのみ使用する戦略の対処

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: ゲーム開始時にプレイヤー名の入力を求め、英字のみを受け付けなければならない（最低1文字以上）
- **FR-002**: 入力された名前の最初の文字を武器、最後の文字を盾、中間の文字数を回復ポーション数に変換しなければならない
- **FR-003**: 各英字には固有の数値パラメータが割り当てられ、武器は攻撃力、盾は防御力として機能しなければならない
- **FR-004**: 戦闘はターン制で、プレイヤーターンと敵ターンが交互に発生しなければならない
- **FR-005**: プレイヤーのターンでは「攻撃」「防御」「回復ポーション使用（所持時）」から1つを選択できなければならない
- **FR-006**: 敵の次の行動が、プレイヤーのターン開始前に予告表示されなければならない
- **FR-007**: 攻撃選択時、武器の攻撃力分のダメージを敵に与えなければならない
- **FR-008**: 防御選択時、盾の防御力分だけ敵の攻撃ダメージを軽減しなければならない
- **FR-009**: 回復ポーション使用時、一定量HPを回復し、回復ポーション数を1減少させなければならない
- **FR-010**: プレイヤーまたは敵のHPが0以下になった場合、戦闘を終了しなければならない
- **FR-011**: 敵を倒した場合、その敵の英単語から1文字を選択できる画面を表示しなければならない
- **FR-012**: 選択した文字を武器または盾に追加でき、追加後にパラメータが再計算されなければならない
- **FR-013**: 敵は倒すごとに徐々に難易度が上昇し（より長い単語、高いHP・攻撃力）、ランダムに出現しなければならない
- **FR-014**: 一定数の敵を倒すと、ボス敵が出現しなければならない
- **FR-015**: ボスは通常敵より高いHP・攻撃力を持ち、特殊攻撃パターンを持たなければならない
- **FR-016**: ボスを倒すとゲームクリア画面を表示し、プレイヤーの統計を表示しなければならない
- **FR-017**: ゲームオーバーまたはクリア後、リスタートしてゲームを最初から再開できなければならない
- **FR-018**: 既存のGameData、GameManager、ゲームオーバーCanvasを活用して実装しなければならない
- **FR-019**: 戦闘時のプレイヤー操作（攻撃・防御・回復ポーション使用・リスタート等）は全てキーボード入力のみで行えなければならない（マウスクリック用UIボタンを設置しない）
- **FR-020**: 現在選択可能な操作の一覧（例: Attack[A] / Defend[D] / Potion[R] / Restart[Enter] など）を常時表示する専用UIパネルを表示し、ターン状態に応じて動的に更新しなければならない

### Key Entities

- **プレイヤー**: 名前（英単語）から生成される武器・盾・回復ポーションを持つ。HP、現在の装備文字列、回復ポーション残数を持つ
- **武器**: 攻撃力を持つ装備。文字列（1文字以上）で構成され、文字数と文字種により攻撃力が決定される
- **盾**: 防御力を持つ装備。文字列（1文字以上）で構成され、文字数と文字種により防御力が決定される
- **回復ポーション**: HP回復アイテム。初期名前の中間文字数分所持。使い切り
- **敵**: 英単語で表現されるNPC。HP、攻撃力、英単語（構成文字）を持つ。倒すと構成文字の1つを獲得できる
- **ボス**: 特別な敵。高HP、高攻撃力、長い英単語、特殊攻撃パターンを持つ
- **文字パラメータ**: 各英字（A-Z）に割り当てられた攻撃力・防御力の基礎値
- **戦闘状態**: 現在のターン、プレイヤーと敵のHP、選択可能な行動、敵の次の行動予告を管理
- **ゲーム進行**: 倒した敵の数、現在の難易度、ボス出現条件を管理

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: プレイヤーが名前入力から最初の戦闘開始まで10秒以内に到達できる
- **SC-002**: 各ターンの行動選択から結果表示まで1秒以内に完了する
- **SC-003**: 初心者プレイヤーが5回以内のプレイで基本ルール（文字の武器/盾変換、敵から文字獲得、成長システム）を理解できる
- **SC-004**: 平均プレイ時間が5～15分で、ボス到達までのゲーム進行がバランスされている
- **SC-005**: プレイヤーの80%以上が1回のプレイで最低3体の敵を倒せる（適切な難易度バランス）
- **SC-006**: ボスをクリアしたプレイヤーの統計画面が3秒以内に表示され、再プレイが即座に可能
- **SC-007**: WebGLビルドで全機能が正常に動作し、フレームレート60fpsを維持する
